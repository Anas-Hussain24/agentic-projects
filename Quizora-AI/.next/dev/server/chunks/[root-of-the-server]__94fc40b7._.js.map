{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///D:/agentic-projects/Quizora-AI/frontend/src/app/api/process/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { writeFile, unlink } from 'fs/promises';\r\nimport { join } from 'path';\r\nimport { exec } from 'child_process';\r\nimport { promisify } from 'util';\r\nimport os from 'os';\r\n\r\nconst execAsync = promisify(exec);\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const formData = await req.formData();\r\n    const file = formData.get('file') as File;\r\n    const mode = formData.get('mode') as string;\r\n\r\n    if (!file) {\r\n      return NextResponse.json({ success: false, error: 'No file uploaded' }, { status: 400 });\r\n    }\r\n\r\n    if (!mode || !['summary', 'quiz'].includes(mode)) {\r\n      return NextResponse.json({ success: false, error: 'Invalid mode' }, { status: 400 });\r\n    }\r\n\r\n    const bytes = await file.arrayBuffer();\r\n    const buffer = Buffer.from(bytes);\r\n\r\n    // Save file temporarily\r\n    const tempDir = os.tmpdir();\r\n    const tempFilePath = join(tempDir, `upload-${Date.now()}.pdf`);\r\n    await writeFile(tempFilePath, buffer);\r\n\r\n    // Path to backend script\r\n    // Assuming backend is at ../../backend from the frontend root\r\n    // We are in src/app/api/process, so we need to go up to project root\r\n    // But process.cwd() in Next.js usually points to the project root (frontend folder)\r\n    // So backend should be at ../backend\r\n    const backendScriptPath = join(process.cwd(), '..', 'backend', 'process_pdf.py');\r\n    \r\n    // Command to run python script\r\n    // Using 'python' assuming it's in the path. Might need 'python3' or full path.\r\n    const command = `python \"${backendScriptPath}\" ${mode} \"${tempFilePath}\"`;\r\n\r\n    console.log(`Executing: ${command}`);\r\n\r\n    try {\r\n      const { stdout, stderr } = await execAsync(command);\r\n      \r\n      // Clean up temp file\r\n      await unlink(tempFilePath);\r\n\r\n      if (stderr) {\r\n        console.error('Python stderr:', stderr);\r\n        // Don't return error immediately as some libs print to stderr (like tensorflow/pypdf sometimes)\r\n        // unless stdout is empty\r\n      }\r\n\r\n      try {\r\n        const result = JSON.parse(stdout);\r\n        return NextResponse.json(result);\r\n      } catch (e) {\r\n        console.error('Failed to parse JSON:', stdout);\r\n        return NextResponse.json({ success: false, error: 'Invalid response from backend', raw: stdout }, { status: 500 });\r\n      }\r\n\r\n    } catch (execError: any) {\r\n      await unlink(tempFilePath).catch(() => {}); // Try to clean up\r\n      console.error('Execution error:', execError);\r\n      return NextResponse.json({ success: false, error: 'Failed to process file', details: execError.message }, { status: 500 });\r\n    }\r\n\r\n  } catch (error: any) {\r\n    console.error('API Error:', error);\r\n    return NextResponse.json({ success: false, error: 'Internal server error', details: error.message }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAEA,MAAM,YAAY,IAAA,8GAAS,EAAC,2HAAI;AAEzB,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,WAAW,MAAM,IAAI,QAAQ;QACnC,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,MAAM,OAAO,SAAS,GAAG,CAAC;QAE1B,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxF;QAEA,IAAI,CAAC,QAAQ,CAAC;YAAC;YAAW;SAAO,CAAC,QAAQ,CAAC,OAAO;YAChD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpF;QAEA,MAAM,QAAQ,MAAM,KAAK,WAAW;QACpC,MAAM,SAAS,OAAO,IAAI,CAAC;QAE3B,wBAAwB;QACxB,MAAM,UAAU,wGAAE,CAAC,MAAM;QACzB,MAAM,eAAe,IAAA,yGAAI,EAAC,SAAS,CAAC,OAAO,EAAE,KAAK,GAAG,GAAG,IAAI,CAAC;QAC7D,MAAM,IAAA,kIAAS,EAAC,cAAc;QAE9B,yBAAyB;QACzB,8DAA8D;QAC9D,qEAAqE;QACrE,oFAAoF;QACpF,qCAAqC;QACrC,MAAM,oBAAoB,IAAA,yGAAI,EAAC,QAAQ,GAAG,IAAI,MAAM,WAAW;QAE/D,+BAA+B;QAC/B,+EAA+E;QAC/E,MAAM,UAAU,CAAC,QAAQ,EAAE,kBAAkB,EAAE,EAAE,KAAK,EAAE,EAAE,aAAa,CAAC,CAAC;QAEzE,QAAQ,GAAG,CAAC,CAAC,WAAW,EAAE,SAAS;QAEnC,IAAI;YACF,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,UAAU;YAE3C,qBAAqB;YACrB,MAAM,IAAA,+HAAM,EAAC;YAEb,IAAI,QAAQ;gBACV,QAAQ,KAAK,CAAC,kBAAkB;YAChC,gGAAgG;YAChG,yBAAyB;YAC3B;YAEA,IAAI;gBACF,MAAM,SAAS,KAAK,KAAK,CAAC;gBAC1B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAC3B,EAAE,OAAO,GAAG;gBACV,QAAQ,KAAK,CAAC,yBAAyB;gBACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;oBAAE,SAAS;oBAAO,OAAO;oBAAiC,KAAK;gBAAO,GAAG;oBAAE,QAAQ;gBAAI;YAClH;QAEF,EAAE,OAAO,WAAgB;YACvB,MAAM,IAAA,+HAAM,EAAC,cAAc,KAAK,CAAC,KAAO,IAAI,kBAAkB;YAC9D,QAAQ,KAAK,CAAC,oBAAoB;YAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;gBAA0B,SAAS,UAAU,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QAC1H;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;YAAyB,SAAS,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACrH;AACF"}}]
}